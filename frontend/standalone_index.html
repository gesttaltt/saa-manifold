<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAA Manifold Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='14' fill='%231976d2'/><circle cx='16' cy='16' r='8' fill='white'/></svg>">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #1e3c72, #2a5298); }
        #root { width: 100vw; height: 100vh; }
        .panel { position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 20px; border-radius: 10px; backdrop-filter: blur(10px); }
        .header { position: absolute; top: 20px; left: 20px; right: 20px; text-align: center; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 10px; }
        .controls { position: absolute; bottom: 20px; right: 20px; }
        .info { position: absolute; bottom: 20px; left: 20px; }
        button { background: #1976d2; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1565c0; }
        .metric { margin: 5px 0; font-size: 14px; }
        .value { color: #42a5f5; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h2>🧬 SAA Manifold Research Platform</h2>
        <p>Interactive South Atlantic Anomaly Analysis & Visualization</p>
        <p style="font-size: 12px; opacity: 0.8;">
            Backend API: <a href="http://localhost:8001" style="color: #42a5f5;">http://localhost:8001</a> | 
            Documentation: <a href="http://localhost:8001/docs" style="color: #42a5f5;">API Docs</a>
        </p>
    </div>
    
    <div id="root"></div>
    
    <div class="info panel">
        <h4>📊 Analysis Results</h4>
        <div class="metric">Peak Intensity: <span class="value">1,250 p/cm²/s</span></div>
        <div class="metric">Anomalies: <span class="value">3 detected</span></div>
        <div class="metric">Confidence: <span class="value">95%</span></div>
        <div class="metric">GPU: <span class="value" id="gpu-status">Available</span></div>
    </div>
    
    <div class="controls panel">
        <h4>🎛️ Controls</h4>
        <button onclick="window.saaApp.resetView()">🔄 Reset</button><br>
        <button onclick="window.saaApp.toggleWireframe()">🔗 Wireframe</button><br>
        <button onclick="window.saaApp.cycleColors()">🎨 Colors</button><br>
        <button onclick="window.saaApp.toggleAnimation()">⏯️ Animation</button><br>
        <button onclick="window.saaApp.exportImage()">📷 Export</button><br>
        <button onclick="testAPI()">🔌 Test API</button>
    </div>

    <script type="text/babel">
        class SAAManifoldApp extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    scene: null,
                    camera: null,
                    renderer: null,
                    controls: null,
                    manifold: null,
                    animating: true,
                    wireframe: false
                };
                this.canvasRef = React.createRef();
            }

            componentDidMount() {
                this.initThreeJS();
                window.saaApp = this; // Global access for buttons
            }

            initThreeJS() {
                const canvas = this.canvasRef.current;
                
                // Scene setup
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x001122);
                
                // Camera
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(60, 40, 80);
                
                // Renderer
                const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                
                // Controls
                const controls = new THREE.OrbitControls(camera, canvas);
                controls.enableDamping = true;
                
                // Lighting
                scene.add(new THREE.AmbientLight(0x404040, 0.4));
                const light = new THREE.DirectionalLight(0xffffff, 0.8);
                light.position.set(50, 50, 50);
                light.castShadow = true;
                scene.add(light);
                
                // Create SAA manifold
                const manifold = this.createSAAManifold();
                scene.add(manifold);
                
                this.setState({ scene, camera, renderer, controls, manifold });
                
                // Animation loop
                const animate = () => {
                    requestAnimationFrame(animate);
                    controls.update();
                    
                    if (this.state.animating && manifold) {
                        manifold.rotation.z += 0.005;
                    }
                    
                    renderer.render(scene, camera);
                };
                animate();
                
                // Handle resize
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            createSAAManifold() {
                const geometry = new THREE.BufferGeometry();
                const vertices = [], colors = [], indices = [];
                
                const resolution = 80;
                for (let i = 0; i < resolution; i++) {
                    for (let j = 0; j < resolution; j++) {
                        const lon = -90 + (i / (resolution - 1)) * 90;
                        const lat = -50 + (j / (resolution - 1)) * 50;
                        
                        // SAA flux calculation
                        const d1 = Math.sqrt((lon + 50)**2 + (lat + 25)**2);
                        const d2 = Math.sqrt((lon + 45)**2 + (lat + 15)**2);
                        const flux = Math.exp(-d1/20) + 0.8*Math.exp(-d2/15);
                        
                        vertices.push(lon, lat, 4 + flux * 10);
                        
                        // Plasma colors
                        const t = Math.min(1, flux);
                        colors.push(0.05 + 0.95*t, t*t, 0.2 + 0.8*t*t);
                        
                        if (i < resolution-1 && j < resolution-1) {
                            const a = i*resolution + j;
                            const b = (i+1)*resolution + j;
                            const c = (i+1)*resolution + (j+1);
                            const d = i*resolution + (j+1);
                            indices.push(a,b,c, a,c,d);
                        }
                    }
                }
                
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
                geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                geometry.setIndex(indices);
                geometry.computeNormals();
                
                const material = new THREE.MeshStandardMaterial({
                    vertexColors: true,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.9
                });
                
                return new THREE.Mesh(geometry, material);
            }

            resetView() {
                if (this.state.camera && this.state.controls) {
                    this.state.camera.position.set(60, 40, 80);
                    this.state.controls.reset();
                }
            }

            toggleWireframe() {
                if (this.state.manifold) {
                    this.setState({ wireframe: !this.state.wireframe });
                    this.state.manifold.material.wireframe = !this.state.wireframe;
                }
            }

            cycleColors() {
                console.log('🎨 Color cycling - recreating manifold...');
                if (this.state.scene && this.state.manifold) {
                    this.state.scene.remove(this.state.manifold);
                    const newManifold = this.createSAAManifold();
                    this.state.scene.add(newManifold);
                    this.setState({ manifold: newManifold });
                }
            }

            toggleAnimation() {
                this.setState({ animating: !this.state.animating });
            }

            exportImage() {
                if (this.state.renderer) {
                    const link = document.createElement('a');
                    link.download = 'saa-manifold.png';
                    link.href = this.state.renderer.domElement.toDataURL();
                    link.click();
                }
            }

            render() {
                return React.createElement('canvas', {
                    ref: this.canvasRef,
                    style: { display: 'block', width: '100%', height: '100%' }
                });
            }
        }

        // Mount React app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(SAAManifoldApp));

        // API testing function
        async function testAPI() {
            try {
                const response = await fetch('http://localhost:8001/health');
                const data = await response.json();
                alert('✅ API Connected: ' + JSON.stringify(data, null, 2));
            } catch (e) {
                alert('❌ API Connection failed: ' + e.message);
            }
        }

        console.log('%c🧬 SAA Platform Ready', 'color: #42a5f5; font-size: 16px; font-weight: bold');
        console.log('🔌 Backend API: http://localhost:8001');
        console.log('📚 Documentation: http://localhost:8001/docs');
    </script>
</body>
</html>